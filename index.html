<html>
    <style>
        .numDisplayDiv {
            height: 40;
        }
    </style>
<body style="line-height: 2;">
    <center>
    <b>Decimal Number:</b>
    <br>
    <input id="decimal" oninput="convert();"></input>
    <br>

    <b>Binary Representation</b>
    <div class="numDisplayDiv" id="outputBinary"></div>

    <b>Hexadecimal Representation</b>
    <div class="numDisplayDiv" contentEditable="true" oninput="hexToDecimal(); convert();" id="outputHex"></div>

    <b>Two's Complement</b>
    <div class="numDisplayDiv" id="outputTwosComplement"></div>

    <b>Bits Needed To Store This Number</b>
    <div class="numDisplayDiv" id ="bitsNeeded"></div>

    </center>
    
    <script>
        function setCharAt(str, idx, newChr)  { 
            return str.substring(0, idx) + newChr + str.substring(idx + 1);
        } 

        // To allow users to input different representaions we'll convert the input to decimal first
        // then run the regular set of conversion functions.

        //======================Conversion Functions===========================

        // takes decimal
        function binary(x) {
            var i = 0;
            var odd = false;
            var binaryString = "";

            for (var count = 0; x > 0; count++) {
                i = x % 2;

                binaryString = i + binaryString;
                x = Math.floor(x / 2);
            }

            var c = 4 - binaryString.length % 4;
            if(c != 4) {
                for(;c > 0; c--) {
                    binaryString = "0" + binaryString;
                }
            }
                
            return binaryString;
        }

        // takes binary string
        function hex(s) {
            var hexString = "";
            var fourBitValue = 0;
            var c = 0;

            for (var i = s.length; i > 0; i--) {

                if (i % 4 == 0) {
                    fourBitValue += 1 * s[i-1];
                } else {
                    fourBitValue += Math.pow(2 * s[i-1], (s.length-i)%4);
                }

                if (i % 4 == 1) {
                    //console.log(fourBitValue);
                    hexString = fourBitValue.toString(16) + hexString;
                    //console.log(hexString);
                    fourBitValue = 0;
                }
            }

            return hexString.toUpperCase();
        }

        // takes binary string
        function twosComplement(s) {
            // we can just use JS built in functions, but they only do 32-bit
            // unsigned right shift zero to force number to be treated as unsigned representation 
            // return (-x >>> 0 ).toString(2).slice(32-b-1);

            var twosCompStr = "0000" + s;

            // flip bits
            for (var i = 0; i < twosCompStr.length; i++) {
                if (twosCompStr[i] == "1") {
                    twosCompStr = setCharAt(twosCompStr, i, "0");
                } else {
                    twosCompStr = setCharAt(twosCompStr, i, "1");
                }
            }

            // add one
            var carry = 1;
            for (var i = twosCompStr.length-1; i >= 0; i--) {
                if (carry) {
                    if (twosCompStr[i] == "1") {
                        twosCompStr = setCharAt(twosCompStr, i, "0");
                    } else {
                        twosCompStr = setCharAt(twosCompStr, i, "1");
                        carry = 0;
                        break;
                    }
                }
            }

            return twosCompStr;
        }

        // takes decimal
        function bitsNeeded(n) {
            var b = 0;
            for (var i = 0; i < n; i += Math.pow(2, b++)){};

            return b;
        }

        //=============get user inputs as decimal========================== 
        function hexToDecimal() {
            var hexString = document.getElementById("outputHex").textContent;

            document.getElementById("decimal").value = parseInt(hexString, 16);
        }

        function convert() {
            var decimal = Number(document.getElementById("decimal").value);
            var binaryString = binary(decimal);
            var binStrLength = binaryString.length;

            document.getElementById("outputBinary").textContent = binaryString;
            document.getElementById("bitsNeeded").textContent = bitsNeeded(decimal);
            document.getElementById("outputTwosComplement").textContent = twosComplement(binaryString);
            document.getElementById("outputHex").textContent = hex(binaryString);
        }
    </script>
</body>
</html>
